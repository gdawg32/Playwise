{% extends "base.html" %}

{% block extra_css %}
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800;900&display=swap" rel="stylesheet">

<style>
body {
    background: linear-gradient(135deg, #f8fafc 0%, #f1f5f9 100%);
    font-family: 'Inter', system-ui, -apple-system, sans-serif;
}

main {
    padding-top: 100px;
    padding-bottom: 4rem;
}

.admin-wrapper {
    max-width: 1400px;
    margin: 0 auto;
    padding: 2rem;
}

/* Header */
.admin-header {
    background: white;
    border-radius: 20px;
    padding: 2rem 2.5rem;
    box-shadow: 0 4px 24px rgba(124, 58, 237, 0.08);
    border: 2px solid rgba(124, 58, 237, 0.08);
    margin-bottom: 2.5rem;
    display: flex;
    align-items: center;
    justify-content: space-between;
    flex-wrap: wrap;
    gap: 1.5rem;
}

.admin-title {
    font-size: 2rem;
    font-weight: 900;
    background: linear-gradient(135deg, #7c3aed, #3b82f6);
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    margin: 0;
    letter-spacing: -0.02em;
}

.logout-btn {
    padding: 0.75rem 1.5rem;
    border-radius: 12px;
    border: 2px solid #e2e8f0;
    background: white;
    color: #64748b;
    font-weight: 600;
    font-size: 0.9375rem;
    transition: all 0.2s ease;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
}

.logout-btn:hover {
    border-color: #ef4444;
    color: #ef4444;
}

/* Pipeline Section */
.pipeline-section {
    background: white;
    border-radius: 20px;
    padding: 2.5rem;
    box-shadow: 0 4px 24px rgba(124, 58, 237, 0.08);
    border: 2px solid rgba(124, 58, 237, 0.08);
    margin-bottom: 2.5rem;
}

.section-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 2rem;
    flex-wrap: wrap;
    gap: 1rem;
}

.section-title {
    font-size: 1.5rem;
    font-weight: 800;
    color: #1e293b;
    margin: 0;
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.section-title::before {
    content: '';
    width: 4px;
    height: 28px;
    background: linear-gradient(135deg, #7c3aed, #3b82f6);
    border-radius: 4px;
}

.section-subtitle {
    font-size: 0.9375rem;
    color: #64748b;
    margin-top: 0.5rem;
}

/* Pipeline Steps */
.pipeline-steps {
    display: flex;
    align-items: flex-start;
    justify-content: space-between;
    gap: 2rem;
    margin-bottom: 2.5rem;
    position: relative;
    padding: 2rem 0;
}

.pipeline-step {
    flex: 1;
    position: relative;
    z-index: 2;
}

/* Connector Lines */
.pipeline-step:not(:last-child)::after {
    content: '';
    position: absolute;
    top: 48px;
    left: calc(50% + 48px);
    width: calc(100% - 96px + 2rem);
    height: 3px;
    background: #e2e8f0;
    z-index: 0;
    transition: background 0.5s ease;
}

.pipeline-step.connector-active::after {
    background: linear-gradient(90deg, #3b82f6 0%, #3b82f6 50%, #e2e8f0 50%);
    animation: progressLine 0.8s ease-in-out;
}

.pipeline-step.connector-completed::after {
    background: #10b981;
}

@keyframes progressLine {
    from {
        background: linear-gradient(90deg, #3b82f6 0%, #3b82f6 0%, #e2e8f0 0%);
    }
    to {
        background: linear-gradient(90deg, #3b82f6 0%, #3b82f6 100%, #e2e8f0 100%);
    }
}

/* Arrow on connectors */
.pipeline-step:not(:last-child)::before {
    content: '';
    position: absolute;
    top: 42px;
    left: calc(100% - 48px + 1rem);
    width: 0;
    height: 0;
    border-left: 8px solid #e2e8f0;
    border-top: 6px solid transparent;
    border-bottom: 6px solid transparent;
    z-index: 1;
    transition: border-left-color 0.5s ease;
}

.pipeline-step.connector-active::before {
    border-left-color: #3b82f6;
}

.pipeline-step.connector-completed::before {
    border-left-color: #10b981;
}

.step-card {
    background: white;
    border: 2px solid #e2e8f0;
    border-radius: 16px;
    padding: 2rem 1.5rem;
    text-align: center;
    transition: all 0.4s cubic-bezier(0.4, 0, 0.2, 1);
    position: relative;
    z-index: 2;
}

.step-card.pending {
    background: #fafafa;
}

.step-card.running {
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.08), rgba(37, 99, 235, 0.06));
    border-color: #3b82f6;
    box-shadow: 0 8px 24px rgba(59, 130, 246, 0.25), 0 0 0 4px rgba(59, 130, 246, 0.1);
    transform: translateY(-4px);
}

.step-card.completed {
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.08), rgba(5, 150, 105, 0.06));
    border-color: #10b981;
    box-shadow: 0 4px 16px rgba(16, 185, 129, 0.15);
}

.step-card.error {
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.08), rgba(220, 38, 38, 0.06));
    border-color: #ef4444;
    box-shadow: 0 4px 16px rgba(239, 68, 68, 0.15);
}

.step-icon {
    width: 72px;
    height: 72px;
    margin: 0 auto 1.25rem;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    background: white;
    border: 3px solid #e2e8f0;
    position: relative;
    transition: all 0.4s ease;
}

.step-card.running .step-icon {
    border-color: #3b82f6;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.1), rgba(37, 99, 235, 0.05));
    animation: iconPulse 2s infinite;
}

.step-card.completed .step-icon {
    border-color: #10b981;
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.05));
}

.step-card.error .step-icon {
    border-color: #ef4444;
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.05));
}

@keyframes iconPulse {
    0%, 100% { 
        box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4);
        transform: scale(1);
    }
    50% { 
        box-shadow: 0 0 0 12px rgba(59, 130, 246, 0);
        transform: scale(1.05);
    }
}

.step-icon svg {
    width: 34px;
    height: 34px;
    color: #64748b;
    transition: all 0.3s ease;
}

.step-card.running .step-icon svg {
    color: #3b82f6;
    animation: rotate 2s linear infinite;
}

.step-card.completed .step-icon svg {
    color: #10b981;
}

.step-card.error .step-icon svg {
    color: #ef4444;
}

@keyframes rotate {
    from { transform: rotate(0deg); }
    to { transform: rotate(360deg); }
}

.step-number {
    position: absolute;
    top: -8px;
    right: -8px;
    width: 28px;
    height: 28px;
    background: linear-gradient(135deg, #1e293b, #334155);
    color: white;
    border-radius: 50%;
    font-size: 0.8125rem;
    font-weight: 700;
    display: flex;
    align-items: center;
    justify-content: center;
    border: 3px solid white;
    box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15);
    z-index: 1;
}

.step-card.running .step-number {
    background: linear-gradient(135deg, #3b82f6, #2563eb);
    animation: numberPulse 1.5s infinite;
}

.step-card.completed .step-number {
    background: linear-gradient(135deg, #10b981, #059669);
}

.step-card.error .step-number {
    background: linear-gradient(135deg, #ef4444, #dc2626);
}

@keyframes numberPulse {
    0%, 100% { transform: scale(1); }
    50% { transform: scale(1.1); }
}

.step-title {
    font-size: 1.0625rem;
    font-weight: 700;
    color: #1e293b;
    margin-bottom: 0.5rem;
    letter-spacing: -0.01em;
}

.step-status {
    font-size: 0.8125rem;
    color: #64748b;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.05em;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 0.375rem;
}

.step-status::before {
    content: '';
    width: 6px;
    height: 6px;
    background: #cbd5e1;
    border-radius: 50%;
}

.step-card.running .step-status {
    color: #3b82f6;
}

.step-card.running .step-status::before {
    background: #3b82f6;
    animation: statusBlink 1.5s infinite;
}

.step-card.completed .step-status {
    color: #10b981;
}

.step-card.completed .step-status::before {
    background: #10b981;
}

.step-card.error .step-status {
    color: #ef4444;
}

.step-card.error .step-status::before {
    background: #ef4444;
}

@keyframes statusBlink {
    0%, 100% { opacity: 1; }
    50% { opacity: 0.3; }
}

/* Responsive */
@media (max-width: 968px) {
    .pipeline-steps {
        flex-direction: column;
        gap: 3rem;
    }
    
    .pipeline-step:not(:last-child)::after {
        top: auto;
        left: 50%;
        bottom: -3rem;
        width: 3px;
        height: 2rem;
        transform: translateX(-50%);
    }
    
    .pipeline-step:not(:last-child)::before {
        top: auto;
        left: 50%;
        bottom: -3rem;
        transform: translateX(-50%) rotate(90deg);
    }
}


/* Pipeline Controls */
.pipeline-controls {
    display: flex;
    gap: 1rem;
    justify-content: center;
}

.pipeline-btn {
    padding: 1rem 2rem;
    border-radius: 12px;
    border: none;
    font-weight: 700;
    font-size: 1rem;
    cursor: pointer;
    transition: all 0.3s ease;
    display: inline-flex;
    align-items: center;
    gap: 0.75rem;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.pipeline-btn-primary {
    background: linear-gradient(135deg, #7c3aed, #3b82f6);
    color: white;
    box-shadow: 0 4px 16px rgba(124, 58, 237, 0.3);
}

.pipeline-btn-primary:hover:not(:disabled) {
    box-shadow: 0 6px 24px rgba(124, 58, 237, 0.4);
    transform: translateY(-2px);
}

.pipeline-btn:disabled {
    opacity: 0.5;
    cursor: not-allowed;
}

/* Logs */
.logs-container {
    background: #0f172a;
    border-radius: 12px;
    padding: 1.5rem;
    margin-top: 2rem;
    max-height: 400px;
    overflow-y: auto;
    font-family: 'Monaco', 'Courier New', monospace;
    font-size: 0.875rem;
    line-height: 1.8;
    display: none;
}

.logs-container.active {
    display: block;
}

.log-entry {
    color: #cbd5e1;
    margin-bottom: 0.5rem;
}

.log-entry.success {
    color: #10b981;
}

.log-entry.error {
    color: #ef4444;
}

/* Pipeline animations */
.step-pending {
    border-color: #e5e7eb !important;
}

.step-running {
    border-color: #3b82f6 !important;
    background: linear-gradient(135deg, rgba(59, 130, 246, 0.05), rgba(37, 99, 235, 0.03)) !important;
    box-shadow: 0 4px 12px rgba(59, 130, 246, 0.2) !important;
}

.step-completed {
    border-color: #10b981 !important;
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.05), rgba(5, 150, 105, 0.03)) !important;
}

.step-error {
    border-color: #ef4444 !important;
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.05), rgba(220, 38, 38, 0.03)) !important;
}

.icon-pending {
    border-color: #d1d5db !important;
    color: #9ca3af !important;
}

.icon-running {
    border-color: #3b82f6 !important;
    color: #3b82f6 !important;
    animation: pulse 2s infinite !important;
}

.icon-completed {
    border-color: #10b981 !important;
    background: #10b981 !important;
    color: white !important;
}

.icon-error {
    border-color: #ef4444 !important;
    background: #ef4444 !important;
    color: white !important;
}

.connector-active {
    background: linear-gradient(to bottom, #3b82f6, #e5e7eb) !important;
}

.connector-completed {
    background: #10b981 !important;
}

@keyframes pulse {
    0%, 100% { box-shadow: 0 0 0 0 rgba(59, 130, 246, 0.4); }
    50% { box-shadow: 0 0 0 8px rgba(59, 130, 246, 0); }
}

.log-entry {
    margin-bottom: 0.5rem;
    line-height: 1.6;
}

.log-entry.success {
    color: #10b981;
}

.log-entry.error {
    color: #ef4444;
}


/* Player Stats Section */
.stats-card {
    background: white;
    border-radius: 20px;
    padding: 2.5rem;
    box-shadow: 0 4px 24px rgba(124, 58, 237, 0.08);
    border: 2px solid rgba(124, 58, 237, 0.08);
}

.stats-content {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: 2rem;
    flex-wrap: wrap;
}

.stats-info {
    flex: 1;
}

.stats-title {
    font-size: 1.5rem;
    font-weight: 800;
    color: #1e293b;
    margin-bottom: 0.5rem;
}

.stats-description {
    font-size: 0.9375rem;
    color: #64748b;
    line-height: 1.6;
}

.stats-btn {
    padding: 1rem 2rem;
    border-radius: 12px;
    border: 2px solid #1e293b;
    background: white;
    color: #1e293b;
    font-weight: 700;
    font-size: 0.9375rem;
    cursor: pointer;
    transition: all 0.3s ease;
    text-transform: uppercase;
    letter-spacing: 0.05em;
}

.stats-btn:hover {
    background: #1e293b;
    color: white;
    box-shadow: 0 4px 16px rgba(30, 41, 59, 0.2);
}

/* Messages */
.messages-container {
    margin-top: 2.5rem;
}

.message {
    padding: 1.25rem 1.5rem;
    border-radius: 12px;
    margin-bottom: 1rem;
    display: flex;
    align-items: center;
    gap: 0.75rem;
    font-weight: 600;
}

.message.success {
    background: linear-gradient(135deg, rgba(16, 185, 129, 0.1), rgba(5, 150, 105, 0.05));
    border: 1px solid rgba(16, 185, 129, 0.2);
    color: #059669;
}

.message.error {
    background: linear-gradient(135deg, rgba(239, 68, 68, 0.1), rgba(220, 38, 38, 0.05));
    border: 1px solid rgba(239, 68, 68, 0.2);
    color: #dc2626;
}

/* Spinner */
.spinner {
    display: inline-block;
    width: 20px;
    height: 20px;
    border: 3px solid rgba(255, 255, 255, 0.3);
    border-top-color: white;
    border-radius: 50%;
    animation: spin 0.8s linear infinite;
}

@keyframes spin {
    to { transform: rotate(360deg); }
}

/* Responsive */
@media (max-width: 968px) {
    .pipeline-steps {
        grid-template-columns: 1fr;
    }
    
    .pipeline-steps::before {
        display: none;
    }
    
    .stats-content {
        flex-direction: column;
        align-items: flex-start;
    }
}

/* Enhanced responsiveness for admin dashboard */
@media (max-width: 1024px) {
    .admin-wrapper {
        padding: 1.5rem;
    }

    .admin-header {
        padding: 1.5rem;
    }

    .admin-title {
        font-size: 1.5rem;
    }

    .pipeline-section {
        padding: 2rem;
    }

    .section-title {
        font-size: 1.25rem;
    }

    .section-subtitle {
        font-size: 0.875rem;
    }
}

@media (max-width: 640px) {
    .admin-wrapper {
        padding: 1rem;
    }

    .admin-header {
        padding: 1.25rem;
        gap: 1rem;
    }

    .admin-title {
        font-size: 1.25rem;
    }

    .logout-btn {
        padding: 0.625rem 1.25rem;
        font-size: 0.875rem;
    }

    .pipeline-section {
        padding: 1.5rem;
    }

    .section-title {
        font-size: 1.125rem;
    }

    .section-title::before {
        width: 3px;
        height: 20px;
    }

    /* Pipeline steps mobile adjustments */
    .flex.items-center.gap-4 {
        gap: 0.75rem;
    }

    #step-icon-0, #step-icon-1, #step-icon-2 {
        width: 3rem;
        height: 3rem;
    }

    #step-card-0, #step-card-1, #step-card-2 {
        padding: 1rem;
    }

    #step-card-0 h3, #step-card-1 h3, #step-card-2 h3 {
        font-size: 1rem;
    }

    #step-card-0 p, #step-card-1 p, #step-card-2 p {
        font-size: 0.75rem;
    }

    /* Button adjustments */
    .bg-gradient-to-r {
        padding: 0.875rem 1.5rem;
    }

    .bg-gradient-to-r span {
        font-size: 0.875rem;
    }
}

</style>
{% endblock %}

{% block content %}

<div class="admin-wrapper">
    
    <!-- Header -->
    <div class="admin-header">
        <h1 class="admin-title">Admin Dashboard</h1>
        <a href="{% url 'manager_logout' %}" class="logout-btn">
            <svg width="18" height="18" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"></path>
            </svg>
            Logout
        </a>
    </div>

    <!-- ML Pipeline -->
    <div class="pipeline-section">
        <div class="section-header">
            <div>
                <h2 class="section-title">ML Pipeline</h2>
                <p class="section-subtitle">Automated match prediction pipeline: data update → feature engineering → model training</p>
            </div>
        </div>

<!-- Pipeline Steps -->
<div class="space-y-6 mb-8">
    <!-- Step 1 -->
    <div class="flex items-center gap-4">
        <div class="flex-shrink-0 w-16 h-16 rounded-full bg-white border-2 border-gray-300 flex items-center justify-center font-bold text-gray-500 shadow-sm transition-all duration-300" id="step-icon-0">
            <span class="text-lg">1</span>
        </div>
        <div class="flex-1 bg-white border-2 border-gray-200 rounded-xl p-5 transition-all duration-300 hover:shadow-md" id="step-card-0">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="font-bold text-gray-900 text-lg mb-1">Update Matches</h3>
                    <p class="text-sm text-gray-500">Fetch and import latest match data</p>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-xs font-semibold text-gray-400 uppercase tracking-wide" id="step-status-0">Pending</span>
                    <div class="w-2 h-2 rounded-full bg-gray-300" id="step-indicator-0"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Connector -->
    <div class="flex items-center gap-4">
        <div class="w-16 flex justify-center">
            <div class="w-0.5 h-8 bg-gray-200 transition-all duration-500" id="connector-0"></div>
        </div>
    </div>

    <!-- Step 2 -->
    <div class="flex items-center gap-4">
        <div class="flex-shrink-0 w-16 h-16 rounded-full bg-white border-2 border-gray-300 flex items-center justify-center font-bold text-gray-500 shadow-sm transition-all duration-300" id="step-icon-1">
            <span class="text-lg">2</span>
        </div>
        <div class="flex-1 bg-white border-2 border-gray-200 rounded-xl p-5 transition-all duration-300 hover:shadow-md" id="step-card-1">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="font-bold text-gray-900 text-lg mb-1">Generate Features</h3>
                    <p class="text-sm text-gray-500">Build model-ready feature dataset</p>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-xs font-semibold text-gray-400 uppercase tracking-wide" id="step-status-1">Pending</span>
                    <div class="w-2 h-2 rounded-full bg-gray-300" id="step-indicator-1"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Connector -->
    <div class="flex items-center gap-4">
        <div class="w-16 flex justify-center">
            <div class="w-0.5 h-8 bg-gray-200 transition-all duration-500" id="connector-1"></div>
        </div>
    </div>

    <!-- Step 3 -->
    <div class="flex items-center gap-4">
        <div class="flex-shrink-0 w-16 h-16 rounded-full bg-white border-2 border-gray-300 flex items-center justify-center font-bold text-gray-500 shadow-sm transition-all duration-300" id="step-icon-2">
            <span class="text-lg">3</span>
        </div>
        <div class="flex-1 bg-white border-2 border-gray-200 rounded-xl p-5 transition-all duration-300 hover:shadow-md" id="step-card-2">
            <div class="flex items-center justify-between">
                <div>
                    <h3 class="font-bold text-gray-900 text-lg mb-1">Train Model</h3>
                    <p class="text-sm text-gray-500">Train and save prediction model</p>
                </div>
                <div class="flex items-center gap-2">
                    <span class="text-xs font-semibold text-gray-400 uppercase tracking-wide" id="step-status-2">Pending</span>
                    <div class="w-2 h-2 rounded-full bg-gray-300" id="step-indicator-2"></div>
                </div>
            </div>
        </div>
    </div>
</div>

<!-- Pipeline Controls -->
<div class="flex justify-center mb-8">
    <button id="runPipeline" class="bg-gradient-to-r from-purple-600 to-blue-500 hover:from-purple-700 hover:to-blue-600 text-white font-bold py-3 px-8 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center gap-3">
        <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24" class="flex-shrink-0">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M14.752 11.168l-3.197-2.132A1 1 0 0010 9.87v4.263a1 1 0 001.555.832l3.197-2.132a1 1 0 000-1.664z"></path>
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
        </svg>
        <span id="pipelineBtnText">Run Pipeline</span>
    </button>
</div>

<!-- Logs -->
<div id="logsContainer" class="hidden bg-gray-900 rounded-xl p-6 font-mono text-sm text-gray-300 max-h-96 overflow-y-auto"></div>

<!-- Player Stats Update -->
<div class="pipeline-section">
    <div class="section-header">
        <div>
            <h2 class="section-title">Player Statistics Update</h2>
            <p class="section-subtitle">Independent update for player season stats and match summaries</p>
        </div>
    </div>

    <div class="bg-gradient-to-br from-slate-50 to-gray-50 rounded-2xl p-8 border-2 border-gray-200">
        <div class="flex flex-col lg:flex-row items-start lg:items-center gap-6">
            <!-- Icon Section -->
            <div class="flex-shrink-0">
                <div class="w-20 h-20 rounded-2xl bg-gradient-to-br from-slate-700 to-slate-900 flex items-center justify-center shadow-lg">
                    <svg class="w-10 h-10 text-white" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"></path>
                    </svg>
                </div>
            </div>

            <!-- Content Section -->
            <div class="flex-1">
                <h3 class="text-xl font-bold text-gray-900 mb-2">Update Player Data</h3>
                <p class="text-gray-600 text-sm leading-relaxed mb-4">
                    Fetches and imports the latest player season statistics and match summaries from the data source. This includes individual performance metrics, goals, assists, and advanced analytics.
                </p>
                
                <!-- Process Steps -->
                <div class="grid grid-cols-1 sm:grid-cols-2 gap-3" id="playerStatsSteps">
                    <div class="flex items-center gap-2 text-sm text-gray-600" id="player-step-0">
                        <div class="w-4 h-4 flex-shrink-0">
                            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <span>Update season CSV data</span>
                    </div>
                    <div class="flex items-center gap-2 text-sm text-gray-600" id="player-step-1">
                        <div class="w-4 h-4 flex-shrink-0">
                            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <span>Import season statistics</span>
                    </div>
                    <div class="flex items-center gap-2 text-sm text-gray-600" id="player-step-2">
                        <div class="w-4 h-4 flex-shrink-0">
                            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <span>Update match summaries</span>
                    </div>
                    <div class="flex items-center gap-2 text-sm text-gray-600" id="player-step-3">
                        <div class="w-4 h-4 flex-shrink-0">
                            <svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                        </div>
                        <span>Import match statistics</span>
                    </div>
                </div>
            </div>

            <!-- Button Section -->
            <div class="flex-shrink-0 w-full lg:w-auto">
                <button id="runPlayerStats" type="button" class="w-full lg:w-auto bg-slate-900 hover:bg-slate-800 text-white font-bold py-4 px-8 rounded-xl shadow-lg hover:shadow-xl transition-all duration-300 disabled:opacity-50 disabled:cursor-not-allowed flex items-center justify-center gap-3 group">
                    <svg class="w-5 h-5 group-hover:rotate-180 transition-transform duration-500" id="playerStatsIcon" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                    </svg>
                    <span class="uppercase tracking-wide text-sm" id="playerStatsBtnText">Run Update</span>
                </button>
            </div>
        </div>
    </div>

    <!-- Progress Logs -->
    <div id="playerStatsLogs" class="hidden bg-gray-900 rounded-xl p-6 font-mono text-sm text-gray-300 max-h-80 overflow-y-auto mt-4"></div>
</div>


    <!-- Messages -->
    {% if messages %}
    <div class="messages-container">
        {% for message in messages %}
        <div class="message {% if message.tags %}{{ message.tags }}{% endif %}">
            <svg width="20" height="20" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z"></path>
            </svg>
            {{ message }}
        </div>
        {% endfor %}
    </div>
    {% endif %}

</div>

<script>
    const runPipelineBtn = document.getElementById('runPipeline');
    const pipelineBtnText = document.getElementById('pipelineBtnText');
    const logsContainer = document.getElementById('logsContainer');
    let pollInterval = null;
    
    const runPlayerStatsBtn = document.getElementById('runPlayerStats');
    const playerStatsBtnText = document.getElementById('playerStatsBtnText');
    const playerStatsIcon = document.getElementById('playerStatsIcon');
    const playerStatsLogs = document.getElementById('playerStatsLogs');
    let playerStatsPollInterval = null;

    async function runPipeline() {
        runPipelineBtn.disabled = true;
        pipelineBtnText.textContent = 'Running...';
        logsContainer.classList.remove('hidden');
        logsContainer.innerHTML = '';
    
        try {
            const response = await fetch('{% url "admin_run_pipeline" %}', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json'
                }
            });
    
            if (response.ok) {
                pollPipelineStatus();
            } else {
                throw new Error('Failed to start pipeline');
            }
        } catch (error) {
            addLog('✗ Error starting pipeline', 'error');
            runPipelineBtn.disabled = false;
            pipelineBtnText.textContent = 'Run Pipeline';
        }
    }
    
    async function pollPipelineStatus() {
        pollInterval = setInterval(async () => {
            try {
                const response = await fetch('{% url "admin_pipeline_status" %}');
                const status = await response.json();
    
                // Update steps
                status.steps.forEach((step, index) => {
                    const card = document.getElementById(`step-card-${index}`);
                    const icon = document.getElementById(`step-icon-${index}`);
                    const statusText = document.getElementById(`step-status-${index}`);
                    const indicator = document.getElementById(`step-indicator-${index}`);
                    const connector = document.getElementById(`connector-${index}`);
    
                    // Remove all classes
                    card.classList.remove('step-pending', 'step-running', 'step-completed', 'step-error');
                    icon.classList.remove('icon-pending', 'icon-running', 'icon-completed', 'icon-error');
    
                    // Add current status
                    card.classList.add(`step-${step.status}`);
                    icon.classList.add(`icon-${step.status}`);
    
                    // Update status text
                    statusText.textContent = step.status.charAt(0).toUpperCase() + step.status.slice(1);
                    statusText.classList.remove('text-gray-400', 'text-blue-500', 'text-green-500', 'text-red-500');
                    
                    if (step.status === 'running') {
                        statusText.classList.add('text-blue-500');
                        indicator.classList.remove('bg-gray-300', 'bg-green-500', 'bg-red-500');
                        indicator.classList.add('bg-blue-500', 'animate-pulse');
                    } else if (step.status === 'completed') {
                        statusText.classList.add('text-green-500');
                        indicator.classList.remove('bg-gray-300', 'bg-blue-500', 'animate-pulse');
                        indicator.classList.add('bg-green-500');
                    } else if (step.status === 'error') {
                        statusText.classList.add('text-red-500');
                        indicator.classList.remove('bg-gray-300', 'bg-blue-500', 'animate-pulse');
                        indicator.classList.add('bg-red-500');
                    } else {
                        statusText.classList.add('text-gray-400');
                        indicator.classList.add('bg-gray-300');
                    }
    
                    // Update connectors
                    if (connector) {
                        connector.classList.remove('connector-active', 'connector-completed');
                        if (step.status === 'completed' && index < status.steps.length - 1) {
                            connector.classList.add('connector-completed');
                        } else if (step.status === 'running') {
                            connector.classList.add('connector-active');
                        }
                    }
                });
    
                // Update logs
                if (status.logs && status.logs.length > 0) {
                    logsContainer.innerHTML = status.logs.map(log => {
                        const logClass = log.includes('✓') ? 'success' : log.includes('✗') ? 'error' : '';
                        return `<div class="log-entry ${logClass}">${log}</div>`;
                    }).join('');
                    logsContainer.scrollTop = logsContainer.scrollHeight;
                }
    
                // Check if pipeline finished
                if (!status.running) {
                    clearInterval(pollInterval);
                    runPipelineBtn.disabled = false;
                    pipelineBtnText.textContent = 'Run Pipeline';
    
                    if (status.error) {
                        addLog(`✗ ${status.error}`, 'error');
                    }
                }
            } catch (error) {
                console.error('Error polling status:', error);
            }
        }, 1000);
    }
    
    function addLog(message, type = '') {
        const logEntry = document.createElement('div');
        logEntry.className = `log-entry ${type}`;
        logEntry.textContent = message;
        logsContainer.appendChild(logEntry);
        logsContainer.scrollTop = logsContainer.scrollHeight;
    }
    const stepIcons = {
        pending: `<svg class="w-4 h-4 text-gray-400" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                  </svg>`,
        running: `<svg class="w-4 h-4 text-blue-500 animate-spin" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 4v5h.582m15.356 2A8.001 8.001 0 004.582 9m0 0H9m11 11v-5h-.581m0 0a8.003 8.003 0 01-15.357-2m15.357 2H15"></path>
                  </svg>`,
        completed: `<svg class="w-4 h-4 text-green-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                      <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                    </svg>`,
        error: `<svg class="w-4 h-4 text-red-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                  <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M10 14l2-2m0 0l2-2m-2 2l-2-2m2 2l2 2m7-2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                </svg>`
    };
    
    async function runPlayerStatsUpdate() {
        runPlayerStatsBtn.disabled = true;
        playerStatsBtnText.textContent = 'Running...';
        playerStatsIcon.classList.add('animate-spin');
        playerStatsLogs.classList.remove('hidden');
        playerStatsLogs.innerHTML = '';
    
        try {
            const response = await fetch('{% url "admin_run_player_stats_update" %}', {
                method: 'POST',
                headers: {
                    'X-CSRFToken': '{{ csrf_token }}',
                    'Content-Type': 'application/json'
                }
            });
    
            if (response.ok) {
                pollPlayerStatsStatus();
            } else {
                throw new Error('Failed to start player stats update');
            }
        } catch (error) {
            addPlayerStatsLog('✗ Error starting update', 'error');
            runPlayerStatsBtn.disabled = false;
            playerStatsBtnText.textContent = 'Run Update';
            playerStatsIcon.classList.remove('animate-spin');
        }
    }
    
    async function pollPlayerStatsStatus() {
        playerStatsPollInterval = setInterval(async () => {
            try {
                const response = await fetch('{% url "admin_player_stats_status" %}');
                const status = await response.json();
    
                // Update step indicators
                status.steps.forEach((step, index) => {
                    const stepElement = document.getElementById(`player-step-${index}`);
                    if (stepElement) {
                        const iconContainer = stepElement.querySelector('.w-4.h-4');
                        if (iconContainer) {
                            iconContainer.innerHTML = stepIcons[step.status];
                        }
    
                        // Update text color
                        const span = stepElement.querySelector('span');
                        if (span) {
                            span.classList.remove('text-gray-600', 'text-blue-600', 'text-green-600', 'text-red-600');
                            if (step.status === 'running') {
                                span.classList.add('text-blue-600', 'font-semibold');
                            } else if (step.status === 'completed') {
                                span.classList.add('text-green-600', 'font-semibold');
                            } else if (step.status === 'error') {
                                span.classList.add('text-red-600', 'font-semibold');
                            } else {
                                span.classList.add('text-gray-600');
                            }
                        }
                    }
                });
    
                // Update logs
                if (status.logs && status.logs.length > 0) {
                    playerStatsLogs.innerHTML = status.logs.map(log => {
                        const logClass = log.includes('✓') ? 'success' : log.includes('✗') ? 'error' : '';
                        return `<div class="log-entry ${logClass}">${log}</div>`;
                    }).join('');
                    playerStatsLogs.scrollTop = playerStatsLogs.scrollHeight;
                }
    
                // Check if update finished
                if (!status.running) {
                    clearInterval(playerStatsPollInterval);
                    runPlayerStatsBtn.disabled = false;
                    playerStatsBtnText.textContent = 'Run Update';
                    playerStatsIcon.classList.remove('animate-spin');
    
                    if (status.error) {
                        addPlayerStatsLog(`✗ ${status.error}`, 'error');
                    } else {
                        // Show success message
                        const successMsg = document.createElement('div');
                        successMsg.className = 'mt-4 p-4 bg-green-50 border border-green-200 rounded-xl flex items-center gap-3 text-green-700 font-semibold';
                        successMsg.innerHTML = `
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m6 2a9 9 0 11-18 0 9 9 0 0118 0z"></path>
                            </svg>
                            Player statistics updated successfully!
                        `;
                        playerStatsLogs.parentElement.appendChild(successMsg);
                        setTimeout(() => successMsg.remove(), 5000);
                    }
                }
            } catch (error) {
                console.error('Error polling player stats status:', error);
            }
        }, 1000);
    }
    
    function addPlayerStatsLog(message, type = '') {
        const logEntry = document.createElement('div');
        logEntry.className = `log-entry ${type}`;
        logEntry.textContent = message;
        playerStatsLogs.appendChild(logEntry);
        playerStatsLogs.scrollTop = playerStatsLogs.scrollHeight;
    }

    
    runPipelineBtn.addEventListener('click', runPipeline);
    runPlayerStatsBtn.addEventListener('click', runPlayerStatsUpdate);

    
</script>

{% endblock %}
